<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EpiPick í•œêµ­ì–´ â€” í•­ê²½ë ¨ì œ ì„ íƒ ê°€ì´ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f7f4f0;
    --surface: #ffffff;
    --surface2: #f0ede8;
    --border: #ddd8d0;
    --text: #1a1714;
    --text-muted: #7a7268;
    --accent: #1d4a8a;
    --accent-light: #e8eef8;
    --green: #1a6b45;
    --green-light: #e6f4ee;
    --amber: #915c0a;
    --amber-light: #fef3e2;
    --red: #8b1a1a;
    --red-light: #fce8e8;
    --radius: 12px;
    --shadow: 0 2px 12px rgba(0,0,0,0.08);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 15px;
    line-height: 1.6;
  }
  header {
    background: var(--accent);
    color: white;
    padding: 20px 24px 18px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 16px rgba(29,74,138,0.25);
  }
  header .inner {
    max-width: 860px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  header .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 24px;
    letter-spacing: 0.5px;
  }
  header .logo span {
    opacity: 0.7;
    font-size: 14px;
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 300;
    margin-left: 8px;
  }
  header .ref {
    margin-left: auto;
    font-size: 11px;
    opacity: 0.65;
    text-align: right;
    line-height: 1.4;
  }
  main {
    max-width: 860px;
    margin: 0 auto;
    padding: 28px 16px 60px;
  }

  /* Step Bar */
  .steps-bar {
    display: flex;
    align-items: center;
    margin-bottom: 28px;
  }
  .step-item {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    cursor: pointer;
    opacity: 0.4;
    transition: opacity 0.2s;
  }
  .step-item.active { opacity: 1; }
  .step-item.done   { opacity: 0.7; }
  .step-num {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: var(--surface);
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
    color: var(--text-muted);
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .step-item.active .step-num { background: var(--accent); border-color: var(--accent); color: white; }
  .step-item.done   .step-num { background: var(--green);  border-color: var(--green);  color: white; }
  .step-label { font-size: 12px; font-weight: 500; white-space: nowrap; }
  .step-connector { height: 2px; background: var(--border); flex: 0 0 20px; margin: 0 4px; }

  /* Card */
  .card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 28px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }
  .card-title   { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
  .card-subtitle { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }

  /* Warning */
  .warn-box {
    display: none;
    background: #fff3cd;
    border: 1.5px solid #ffc107;
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 13px;
    color: #7d4e00;
    font-weight: 500;
    margin-top: 16px;
    align-items: center;
    gap: 8px;
  }
  .warn-box.show { display: flex; animation: shake 0.3s ease; }
  @keyframes shake {
    0%,100%{ transform:translateX(0); }
    25%    { transform:translateX(-5px); }
    75%    { transform:translateX(5px); }
  }

  /* Seizure grid */
  .options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
  }
  .option-btn {
    border: 2px solid var(--border);
    background: var(--bg);
    border-radius: 10px;
    padding: 14px 16px;
    cursor: pointer;
    text-align: left;
    transition: all 0.15s;
    width: 100%;
  }
  .option-btn:hover   { border-color: var(--accent); background: var(--accent-light); }
  .option-btn.selected { border-color: var(--accent); background: var(--accent-light); }
  .opt-icon   { font-size: 22px; display: block; margin-bottom: 6px; }
  .opt-label  { font-size: 13px; font-weight: 700; display: block; color: var(--text); line-height: 1.3; }
  .opt-label-en { font-size: 10.5px; font-weight: 400; color: var(--text-muted); display: block; margin-top: 1px; }
  .opt-desc   { font-size: 11px; color: var(--text-muted); margin-top: 5px; display: block; line-height: 1.4; }
  .option-btn.selected .opt-label    { color: var(--accent); }
  .option-btn.selected .opt-label-en { color: var(--accent); opacity: 0.75; }

  /* Modifier grid â€” pure divs, no label/input */
  .modifiers-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
  @media(max-width:540px){
    .modifiers-grid { grid-template-columns: 1fr; }
    .options-grid   { grid-template-columns: 1fr 1fr; }
  }
  .mod-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 12px 14px;
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    background: var(--bg);
    transition: all 0.15s;
    user-select: none;
  }
  .mod-item:hover   { border-color: var(--accent); background: var(--accent-light); }
  .mod-item.checked { border-color: var(--accent); background: var(--accent-light); }
  .mod-chk {
    width: 18px; height: 18px;
    border-radius: 4px;
    border: 2px solid var(--border);
    flex-shrink: 0;
    margin-top: 2px;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px;
    transition: all 0.15s;
  }
  .mod-item.checked .mod-chk {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }
  .mod-label { font-size: 13px; font-weight: 500; }
  .mod-sub   { font-size: 11px; color: var(--text-muted); }

  /* Radio style for demographic group */
  .mod-chk.mod-radio { border-radius: 50%; }

  /* Divider hint label */
  .divider-hint {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0;
    text-transform: none;
    color: var(--accent);
    background: var(--accent-light);
    border: 1px solid #c0d0e8;
    border-radius: 20px;
    padding: 1px 8px;
    margin-left: 6px;
    vertical-align: middle;
  }

  /* Section divider */
  .section-divider {
    font-size: 12px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--text-muted);
    margin: 20px 0 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }

  /* Buttons */
  .nav-btns { display: flex; gap: 10px; justify-content: space-between; margin-top: 24px; }
  .btn {
    padding: 12px 24px; border-radius: 8px; border: none;
    cursor: pointer; font-size: 14px; font-weight: 600; font-family: inherit;
    transition: all 0.15s;
  }
  .btn-primary   { background: var(--accent); color: white; }
  .btn-primary:hover { background: #163c70; }
  .btn-secondary { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
  .btn-secondary:hover { background: var(--border); }
  .btn-reset     { background: transparent; color: var(--text-muted); border: 1px solid var(--border); }

  /* Results */
  .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
  .result-icon { font-size: 32px; }
  .result-info h2 { font-size: 20px; font-weight: 700; }
  .result-info p  { font-size: 13px; color: var(--text-muted); }

  .asm-group { margin-bottom: 20px; }
  .asm-group-label { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
  .group-badge {
    padding: 3px 10px; border-radius: 20px;
    font-size: 11px; font-weight: 700; letter-spacing: 0.04em;
  }
  .group-1 .group-badge { background: var(--green-light); color: var(--green); }
  .group-2 .group-badge { background: var(--amber-light); color: var(--amber); }
  .group-3 .group-badge { background: var(--red-light);   color: var(--red);   }
  .group-desc { font-size: 12px; color: var(--text-muted); }

  .asm-tags { display: flex; flex-wrap: wrap; gap: 8px; }
  .asm-tag {
    padding: 7px 13px; border-radius: 8px;
    font-size: 13px; font-weight: 600;
    border: 1.5px solid;
    position: relative;
    text-align: center; line-height: 1.4;
  }
  .asm-tag .drug-ko { display: block; font-size: 10.5px; font-weight: 400; opacity: 0.7; margin-top: 1px; }
  .group-1 .asm-tag { background: var(--green-light); border-color: #a8d5be; color: var(--green); }
  .group-2 .asm-tag { background: var(--amber-light); border-color: #f0c97a; color: var(--amber); }
  .group-3 .asm-tag { background: var(--red-light);   border-color: #e8aaaa; color: var(--red);   }
  .asm-tag.up::after {
    content: 'â–²'; font-size: 9px;
    position: absolute; top: -5px; right: -5px;
    background: var(--green); color: white;
    border-radius: 3px; padding: 1px 3px;
  }
  .asm-tag.down::after {
    content: 'â–¼'; font-size: 9px;
    position: absolute; top: -5px; right: -5px;
    background: var(--red); color: white;
    border-radius: 3px; padding: 1px 3px;
  }

  .modifier-notes {
    background: var(--surface2); border-radius: 10px;
    padding: 16px; margin-top: 20px; border: 1px solid var(--border);
  }
  .modifier-notes h4 { font-size: 13px; font-weight: 700; margin-bottom: 10px; color: var(--text-muted); }
  .mod-note-item { display: flex; gap: 8px; margin-bottom: 6px; font-size: 12px; line-height: 1.5; }
  .mod-note-item .dot { width:6px; height:6px; border-radius:50%; background:var(--accent); flex-shrink:0; margin-top:5px; }

  .summary-bar {
    background: var(--accent-light); border: 1px solid #c0d0e8;
    border-radius: 10px; padding: 12px 16px; margin-bottom: 20px;
    font-size: 13px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;
  }
  .summary-tag {
    background: white; border: 1px solid #c0d0e8; border-radius: 6px;
    padding: 2px 8px; font-size: 12px; color: var(--accent); font-weight: 500;
  }
  .disclaimer {
    background: #fff8e6; border: 1px solid #f0c97a; border-radius: 10px;
    padding: 14px 16px; font-size: 12px; color: #6b4a00; margin-top: 20px; line-height: 1.6;
  }
  .disclaimer strong { display: block; margin-bottom: 4px; }

  .page { display: none; }
  .page.active { display: block; animation: fadeIn 0.2s ease; }
  @keyframes fadeIn {
    from { opacity:0; transform:translateY(8px); }
    to   { opacity:1; transform:translateY(0); }
  }
</style>
</head>
<body>

<header>
  <div class="inner">
    <div class="logo">EpiPick <span>í•œêµ­ì–´</span></div>
    <div class="ref">Asadi-Pooya et al., Epilepsia 2020<br>ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ Â· ì˜ë£Œ ì „ë¬¸ê°€ìš©</div>
  </div>
</header>

<main>
  <!-- Step Bar -->
  <div class="steps-bar">
    <div class="step-item active" id="si-1" onclick="goToStep(1)">
      <div class="step-num">1</div><div class="step-label">ë°œì‘ ìœ í˜•</div>
    </div>
    <div class="step-connector"></div>
    <div class="step-item" id="si-2" onclick="goToStep(2)">
      <div class="step-num">2</div><div class="step-label">í™˜ì íŠ¹ì„±</div>
    </div>
    <div class="step-connector"></div>
    <div class="step-item" id="si-3">
      <div class="step-num">3</div><div class="step-label">ê²°ê³¼</div>
    </div>
  </div>

  <!-- PAGE 1 -->
  <div class="page active" id="page-1">
    <div class="card">
      <div class="card-title">ë°œì‘ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</div>
      <div class="card-subtitle">ê°€ì¥ ì£¼ëœ ë°œì‘ ìœ í˜•ì„ í•˜ë‚˜ ì„ íƒí•˜ì„¸ìš”</div>
      <div class="options-grid">
        <button class="option-btn" onclick="selectSeizure('focal')" id="sz-focal">
          <span class="opt-icon">âš¡</span>
          <span class="opt-label">êµ­ì†Œ ë°œì‘</span>
          <span class="opt-label-en">Focal seizures</span>
          <span class="opt-desc">ì˜ì‹ ìœ ì§€ ë˜ëŠ” ì†Œì‹¤ ë™ë°˜</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('focal_bilateral')" id="sz-focal_bilateral">
          <span class="opt-icon">âš¡âš¡</span>
          <span class="opt-label">êµ­ì†Œâ†’ì–‘ì¸¡ ê°•ì§ê°„ëŒ€</span>
          <span class="opt-label-en">Focal to bilateral tonic-clonic</span>
          <span class="opt-desc">êµ­ì†Œ ì‹œì‘ í›„ ì´ì°¨ ì „ì‹ í™”</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('generalized_tonic_clonic')" id="sz-generalized_tonic_clonic">
          <span class="opt-icon">ğŸŒŠ</span>
          <span class="opt-label">ì „ì‹  ê°•ì§ê°„ëŒ€</span>
          <span class="opt-label-en">Generalized tonic-clonic (GTCS)</span>
          <span class="opt-desc">ì¼ì°¨ì„± ì „ì‹ í™”</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('absence')" id="sz-absence">
          <span class="opt-icon">ğŸ’­</span>
          <span class="opt-label">ê²°ì‹  ë°œì‘</span>
          <span class="opt-label-en">Absence seizures</span>
          <span class="opt-desc">ì†Œì•„/ì²­ì†Œë…„ ê²°ì‹  í¬í•¨</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('myoclonic')" id="sz-myoclonic">
          <span class="opt-icon">ğŸ’¥</span>
          <span class="opt-label">ê·¼ê°„ëŒ€ ë°œì‘</span>
          <span class="opt-label-en">Myoclonic seizures</span>
          <span class="opt-desc">ì²­ì†Œë…„ ê·¼ê°„ëŒ€ ë‡Œì „ì¦ ë“±</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('absence_myoclonic')" id="sz-absence_myoclonic">
          <span class="opt-icon">ğŸ’­ğŸ’¥</span>
          <span class="opt-label">ê²°ì‹  + ê·¼ê°„ëŒ€</span>
          <span class="opt-label-en">Absence + myoclonic</span>
          <span class="opt-desc">ë‘ ìœ í˜•ì´ ê³µì¡´í•˜ëŠ” ê²½ìš°</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('atonic_tonic')" id="sz-atonic_tonic">
          <span class="opt-icon">ğŸ”½</span>
          <span class="opt-label">ë¬´ê¸´ì¥ / ê°•ì§ ë°œì‘</span>
          <span class="opt-label-en">Atonic / tonic seizures</span>
          <span class="opt-desc">ë‚™ìƒ ë°œì‘, Lennox-Gastaut í¬í•¨</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('mixed_generalized')" id="sz-mixed_generalized">
          <span class="opt-icon">ğŸ”€</span>
          <span class="opt-label">í˜¼í•© ì „ì‹  ë°œì‘</span>
          <span class="opt-label-en">Mixed generalized seizures</span>
          <span class="opt-desc">GTCS + ê²°ì‹  ë˜ëŠ” GTCS + ê·¼ê°„ëŒ€</span>
        </button>
        <button class="option-btn" onclick="selectSeizure('spasms')" id="sz-spasms">
          <span class="opt-icon">ğŸ‘¶</span>
          <span class="opt-label">ì—°ì¶•</span>
          <span class="opt-label-en">Epileptic spasms (West)</span>
          <span class="opt-desc">ì˜ì•„ ì—°ì¶• (West ì¦í›„êµ°)</span>
        </button>
      </div>
      <div class="warn-box" id="warn-1">âš ï¸&nbsp; ë°œì‘ ìœ í˜•ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
      <div class="nav-btns">
        <div></div>
        <button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
      </div>
    </div>
  </div>

  <!-- PAGE 2 -->
  <div class="page" id="page-2">
    <div class="card">
      <div class="card-title">í™˜ì íŠ¹ì„± ì…ë ¥</div>
      <div class="card-subtitle">í•´ë‹¹ë˜ëŠ” í•­ëª©ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”. ì—†ìœ¼ë©´ ë°”ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

      <div class="section-divider">ğŸ‘¤ ì¸êµ¬í•™ì  íŠ¹ì„± <span class="divider-hint">(í•œ ê°€ì§€ë§Œ ì„ íƒ ê°€ëŠ¥)</span></div>
      <div class="modifiers-grid">
        <div class="mod-item" id="mod-child"      onclick="selectDemog('child')">
          <div class="mod-chk mod-radio" id="chk-child"></div>
          <div><div class="mod-label">ì†Œì•„ (&lt;12ì„¸)</div><div class="mod-sub">ì†Œì•„ ìš©ëŸ‰ ë° ì œí˜• ê³ ë ¤</div></div>
        </div>
        <div class="mod-item" id="mod-elderly"    onclick="selectDemog('elderly')">
          <div class="mod-chk mod-radio" id="chk-elderly"></div>
          <div><div class="mod-label">ê³ ë ¹ì (â‰¥65ì„¸)</div><div class="mod-sub">ì•½ë¬¼ ìƒí˜¸ì‘ìš©, ë‚™ìƒ ìœ„í—˜</div></div>
        </div>
        <div class="mod-item" id="mod-female_cbp" onclick="selectDemog('female_cbp')">
          <div class="mod-chk mod-radio" id="chk-female_cbp"></div>
          <div><div class="mod-label">ê°€ì„ê¸° ì—¬ì„±</div><div class="mod-sub">í”¼ì„ì•½ ì‚¬ìš© ë˜ëŠ” ì„ì‹  ê°€ëŠ¥ì„±</div></div>
        </div>
        <div class="mod-item" id="mod-pregnant"   onclick="selectDemog('pregnant')">
          <div class="mod-chk mod-radio" id="chk-pregnant"></div>
          <div><div class="mod-label">ì„ì‹  ì¤‘</div><div class="mod-sub">íƒœì•„ê¸°í˜• ìœ„í—˜ ìµœì†Œí™” í•„ìš”</div></div>
        </div>
      </div>

      <div class="section-divider">ğŸ§  ë™ë°˜ ì§ˆí™˜</div>
      <div class="modifiers-grid">
        <div class="mod-item" id="mod-depression"   onclick="toggleMod('depression')">
          <div class="mod-chk" id="chk-depression"></div>
          <div><div class="mod-label">ìš°ìš¸ì¦ / ë¶ˆì•ˆì¥ì• </div><div class="mod-sub">ê¸°ë¶„ì— ì˜í–¥ì£¼ëŠ” ì•½ë¬¼ ê³ ë ¤</div></div>
        </div>
        <div class="mod-item" id="mod-migraine"     onclick="toggleMod('migraine')">
          <div class="mod-chk" id="chk-migraine"></div>
          <div><div class="mod-label">í¸ë‘í†µ</div><div class="mod-sub">ì˜ˆë°© íš¨ê³¼ ê²¸ìš© ì•½ë¬¼ ìœ ë¦¬</div></div>
        </div>
        <div class="mod-item" id="mod-obesity"      onclick="toggleMod('obesity')">
          <div class="mod-chk" id="chk-obesity"></div>
          <div><div class="mod-label">ë¹„ë§Œ</div><div class="mod-sub">ì²´ì¤‘ ì¦ê°€ ì•½ë¬¼ íšŒí”¼</div></div>
        </div>
        <div class="mod-item" id="mod-renal"        onclick="toggleMod('renal')">
          <div class="mod-chk" id="chk-renal"></div>
          <div><div class="mod-label">ì‹ ë¶€ì „</div><div class="mod-sub">ì‹ ì¥ ë°°ì„¤ ì•½ë¬¼ ìš©ëŸ‰ ê°ëŸ‰</div></div>
        </div>
        <div class="mod-item" id="mod-liver"        onclick="toggleMod('liver')">
          <div class="mod-chk" id="chk-liver"></div>
          <div><div class="mod-label">ê°„ì§ˆí™˜</div><div class="mod-sub">ê°„ ëŒ€ì‚¬ ì•½ë¬¼ íšŒí”¼</div></div>
        </div>
        <div class="mod-item" id="mod-cardiac"      onclick="toggleMod('cardiac')">
          <div class="mod-chk" id="chk-cardiac"></div>
          <div><div class="mod-label">ì‹¬ì¥ì§ˆí™˜</div><div class="mod-sub">ì‹¬ë°•ìˆ˜/ì „ë„ ì˜í–¥ ì•½ë¬¼ ì£¼ì˜</div></div>
        </div>
        <div class="mod-item" id="mod-osteoporosis" onclick="toggleMod('osteoporosis')">
          <div class="mod-chk" id="chk-osteoporosis"></div>
          <div><div class="mod-label">ê³¨ë‹¤ê³µì¦</div><div class="mod-sub">ê³¨ë°€ë„ì— ì˜í–¥ì£¼ëŠ” ì•½ë¬¼ ì£¼ì˜</div></div>
        </div>
        <div class="mod-item" id="mod-tumor"        onclick="toggleMod('tumor')">
          <div class="mod-chk" id="chk-tumor"></div>
          <div><div class="mod-label">ë‡Œì¢…ì–‘</div><div class="mod-sub">í•­ì•”ì œ ìƒí˜¸ì‘ìš© ì£¼ì˜</div></div>
        </div>
        <div class="mod-item" id="mod-cognitive"    onclick="toggleMod('cognitive')">
          <div class="mod-chk" id="chk-cognitive"></div>
          <div><div class="mod-label">ì¸ì§€ê¸°ëŠ¥ ì €í•˜</div><div class="mod-sub">ì§„ì • íš¨ê³¼ ìµœì†Œí™” í•„ìš”</div></div>
        </div>
      </div>

      <div class="section-divider">ğŸ’Š ë³‘ìš© ì•½ë¬¼</div>
      <div class="modifiers-grid">
        <div class="mod-item" id="mod-polypharmacy"  onclick="toggleMod('polypharmacy')">
          <div class="mod-chk" id="chk-polypharmacy"></div>
          <div><div class="mod-label">ë‹¤ì¤‘ ì•½ë¬¼ ë³µìš©</div><div class="mod-sub">ì•½ë¬¼ ìƒí˜¸ì‘ìš© ìµœì†Œí™”</div></div>
        </div>
        <div class="mod-item" id="mod-ocp"           onclick="toggleMod('ocp')">
          <div class="mod-chk" id="chk-ocp"></div>
          <div><div class="mod-label">ê²½êµ¬í”¼ì„ì•½ ë³µìš©</div><div class="mod-sub">íš¨ëŠ¥ ê°ì†Œ ìœ ë°œ ì•½ë¬¼ íšŒí”¼</div></div>
        </div>
        <div class="mod-item" id="mod-anticoagulant" onclick="toggleMod('anticoagulant')">
          <div class="mod-chk" id="chk-anticoagulant"></div>
          <div><div class="mod-label">í•­ì‘ê³ ì œ ë³µìš©</div><div class="mod-sub">CYP ìœ ë„ ì•½ë¬¼ ì£¼ì˜</div></div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="btn btn-secondary" onclick="prevStep()">â† ì´ì „</button>
        <button class="btn btn-primary"   onclick="showResults()">ê²°ê³¼ ë³´ê¸° â†’</button>
      </div>
    </div>
  </div>

  <!-- PAGE 3 -->
  <div class="page" id="page-3">
    <div class="card">
      <div class="result-header">
        <div class="result-icon">ğŸ’Š</div>
        <div class="result-info">
          <h2>í•­ê²½ë ¨ì œ ì¶”ì²œ ê²°ê³¼</h2>
          <p id="result-desc">ë°œì‘ ìœ í˜• ë° í™˜ì íŠ¹ì„± ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œ</p>
        </div>
      </div>
      <div id="summary-bar" class="summary-bar"></div>

      <div class="asm-group group-1">
        <div class="asm-group-label">
          <span class="group-badge">1êµ° (ìš°ì„ )</span>
          <span class="group-desc">íš¨ëŠ¥Â·ë‚´ì•½ì„± ê·¼ê±°ê°€ ê°€ì¥ ì¶©ë¶„í•œ ì•½ë¬¼</span>
        </div>
        <div class="asm-tags" id="g1-tags"></div>
      </div>
      <div class="asm-group group-2" style="margin-top:16px">
        <div class="asm-group-label">
          <span class="group-badge">2êµ° (2ì°¨)</span>
          <span class="group-desc">1êµ° ì‹¤íŒ¨ ì‹œ ë˜ëŠ” íŠ¹ì„±ì— ë”°ë¼ ë™ë“± ê³ ë ¤</span>
        </div>
        <div class="asm-tags" id="g2-tags"></div>
      </div>
      <div class="asm-group group-3" style="margin-top:16px">
        <div class="asm-group-label">
          <span class="group-badge">3êµ° (3ì°¨)</span>
          <span class="group-desc">íŠ¹ìˆ˜ ìƒí™© ë˜ëŠ” ë‹¤ì œ ë¶ˆì‘ ì‹œ ê³ ë ¤</span>
        </div>
        <div class="asm-tags" id="g3-tags"></div>
      </div>

      <div id="mod-notes" class="modifier-notes" style="display:none">
        <h4>âš™ï¸ ìˆ˜ì •ì¸ìì— ì˜í•œ ì¡°ì • ì‚¬í•­</h4>
        <div id="notes-list"></div>
      </div>
      <div class="disclaimer">
        <strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong>
        ë³¸ ê²°ê³¼ëŠ” Asadi-Pooya et al. (Epilepsia, 2020) ì•Œê³ ë¦¬ì¦˜ì— ê¸°ë°˜í•œ ì°¸ê³  ì •ë³´ì…ë‹ˆë‹¤. ìµœì¢… ì²˜ë°© ê²°ì •ì€ ë°˜ë“œì‹œ ë‹´ë‹¹ ì˜ë£Œì „ë¬¸ê°€ê°€ ê°œë³„ í™˜ìì˜ ì„ìƒ ìƒí™©ì„ ì¢…í•©ì ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ ë‚´ë ¤ì•¼ í•©ë‹ˆë‹¤.
      </div>
      <div class="nav-btns">
        <button class="btn btn-secondary" onclick="prevStep()">â† íŠ¹ì„± ìˆ˜ì •</button>
        <button class="btn btn-reset"     onclick="resetAll()">ğŸ”„ ì²˜ìŒë¶€í„°</button>
      </div>
    </div>
  </div>
</main>

<script>
/* â”€â”€ Drug dictionary (English key â†’ Korean name) â”€â”€ */
const DRUG_KO = {
  'Levetiracetam':'ë ˆë¹„í‹°ë¼ì„¸íƒ','Lamotrigine':'ë¼ëª¨íŠ¸ë¦¬ì§„',
  'Oxcarbazepine':'ì˜¥ìŠ¤ì¹´ë¥´ë°”ì œí•€','Carbamazepine':'ì¹´ë¥´ë°”ë§ˆì œí•€',
  'Valproate':'ë°œí”„ë¡œì‚°','Lacosamide':'ë¼ì½”ì‚¬ë§ˆì´ë“œ',
  'Eslicarbazepine':'ì—ìŠ¬ë¦¬ì¹´ë¥´ë°”ì œí•€','Perampanel':'í˜ëŒíŒŒë„¬',
  'Phenobarbital':'í˜ë…¸ë°”ë¥´ë¹„íƒˆ','Phenytoin':'í˜ë‹ˆí† ì¸',
  'Topiramate':'í† í”¼ë¼ë©”ì´íŠ¸','Zonisamide':'ì¡°ë‹ˆì‚¬ë§ˆì´ë“œ',
  'Gabapentin':'ê°€ë°”íœí‹´','Pregabalin':'í”„ë ˆê°€ë°œë¦°',
  'Ethosuximide':'ì—í† ì„ì‹œë¯¸ë“œ','Clonazepam':'í´ë¡œë‚˜ì œíŒœ',
  'Acetazolamide':'ì•„ì„¸íƒ€ì¡¸ë¼ë§ˆì´ë“œ','Piracetam':'í”¼ë¼ì„¸íƒ',
  'Brivaracetam':'ë¸Œë¦¬ë°”ë¼ì„¸íƒ','Felbamate':'í ë°”ë©”ì´íŠ¸',
  'Clobazam':'í´ë¡œë°”ì ','Rufinamide':'ë£¨í”¼ë‚˜ë§ˆì´ë“œ',
  'Vigabatrin':'ë¹„ê°€ë°”íŠ¸ë¦°','ACTH':'ACTH',
  'Nitrazepam':'ë‹ˆíŠ¸ë¼ì œíŒœ','Pyridoxine':'í”¼ë¦¬ë…ì‹ ',
};

/* â”€â”€ ASM groups per seizure type (English keys) â”€â”€ */
const ASM = {
  focal:                  { g1:['Levetiracetam','Lamotrigine','Oxcarbazepine','Carbamazepine'],         g2:['Valproate','Lacosamide','Eslicarbazepine','Perampanel'],       g3:['Phenobarbital','Phenytoin','Topiramate','Zonisamide','Gabapentin','Pregabalin'] },
  focal_bilateral:        { g1:['Levetiracetam','Lamotrigine','Oxcarbazepine','Carbamazepine'],         g2:['Valproate','Lacosamide','Eslicarbazepine','Perampanel'],       g3:['Phenobarbital','Phenytoin','Topiramate','Zonisamide'] },
  generalized_tonic_clonic:{ g1:['Valproate','Levetiracetam','Lamotrigine'],                           g2:['Topiramate','Perampanel','Zonisamide'],                        g3:['Phenobarbital','Phenytoin','Felbamate'] },
  absence:                { g1:['Ethosuximide','Valproate','Lamotrigine'],                              g2:['Levetiracetam','Zonisamide','Clonazepam'],                     g3:['Topiramate','Acetazolamide'] },
  myoclonic:              { g1:['Valproate','Levetiracetam'],                                           g2:['Lamotrigine','Clonazepam','Piracetam'],                        g3:['Topiramate','Zonisamide','Perampanel','Brivaracetam'] },
  absence_myoclonic:      { g1:['Valproate','Levetiracetam'],                                           g2:['Lamotrigine','Clonazepam'],                                    g3:['Topiramate','Zonisamide'] },
  atonic_tonic:           { g1:['Valproate','Rufinamide'],                                              g2:['Lamotrigine','Levetiracetam','Topiramate'],                    g3:['Phenobarbital','Felbamate','Clonazepam','Clobazam'] },
  mixed_generalized:      { g1:['Valproate'],                                                           g2:['Levetiracetam','Lamotrigine','Topiramate'],                    g3:['Perampanel','Phenobarbital','Clonazepam'] },
  spasms:                 { g1:['Vigabatrin','ACTH'],                                                   g2:['Clonazepam','Nitrazepam','Valproate'],                         g3:['Topiramate','Zonisamide','Pyridoxine'] },
};

/* â”€â”€ Modifier rules â”€â”€ */
const RULES = {
  female_cbp:   { avoid:['Valproate'],                                                             prefer:['Lamotrigine','Levetiracetam'], note:'ê°€ì„ê¸° ì—¬ì„±: ValproateëŠ” ê¸°í˜• ìœ„í—˜ìœ¼ë¡œ íšŒí”¼ ê¶Œê³ . LamotrigineÂ·Levetiracetam ì„ í˜¸.' },
  pregnant:     { avoid:['Valproate','Phenobarbital','Phenytoin','Topiramate'],                    prefer:['Lamotrigine','Levetiracetam'], note:'ì„ì‹ : ê³ ìš©ëŸ‰ ì—½ì‚° ê¶Œê³ . ValproateÂ·PhenobarbitalÂ·PhenytoinÂ·Topiramate íšŒí”¼.' },
  depression:   { avoid:['Levetiracetam','Perampanel'],                                           prefer:['Lamotrigine'],                 note:'ìš°ìš¸ì¦/ë¶ˆì•ˆ: LevetiracetamÂ·Perampanel ê¸°ë¶„ ë¶€ì‘ìš© ì£¼ì˜. Lamotrigine ê¸°ë¶„ ì•ˆì • íš¨ê³¼.' },
  migraine:     {                                                                                  prefer:['Valproate','Topiramate'],      note:'í¸ë‘í†µ: ValproateÂ·TopiramateëŠ” í¸ë‘í†µ ì˜ˆë°© íš¨ê³¼ ê²¸ë¹„.' },
  obesity:      { avoid:['Valproate','Carbamazepine','Pregabalin','Gabapentin'],                  prefer:['Topiramate','Zonisamide'],      note:'ë¹„ë§Œ: ValproateÂ·CarbamazepineÂ·PregabalinÂ·Gabapentin ì²´ì¤‘ ì¦ê°€. TopiramateÂ·Zonisamide ì²´ì¤‘ ê°ì†Œ.' },
  renal:        { avoid:['Gabapentin','Pregabalin','Levetiracetam'],                                                                       note:'ì‹ ë¶€ì „: GabapentinÂ·PregabalinÂ·Levetiracetam ìš©ëŸ‰ ê°ëŸ‰ ë˜ëŠ” íšŒí”¼.' },
  liver:        { avoid:['Valproate','Carbamazepine','Phenobarbital','Phenytoin'],                 prefer:['Levetiracetam'],               note:'ê°„ì§ˆí™˜: ê°„ ëŒ€ì‚¬ ì•½ë¬¼(Valproate, Carbamazepine ë“±) íšŒí”¼. Levetiracetam ì„ í˜¸.' },
  cardiac:      { avoid:['Carbamazepine','Oxcarbazepine','Eslicarbazepine','Lacosamide'],                                                  note:'ì‹¬ì¥ì§ˆí™˜: Naâº ì±„ë„ ì°¨ë‹¨ì œ(Carbamazepine ë“±) ì‹¬ì „ë„ ì´ìƒ ì£¼ì˜.' },
  osteoporosis: { avoid:['Carbamazepine','Phenobarbital','Phenytoin','Valproate'],                 prefer:['Levetiracetam','Lamotrigine'], note:'ê³¨ë‹¤ê³µì¦: íš¨ì†Œ ìœ ë„ ì•½ë¬¼ ê³¨ë°€ë„ ê°ì†Œ. LevetiracetamÂ·Lamotrigine ì„ í˜¸.' },
  tumor:        { avoid:['Carbamazepine','Phenobarbital','Phenytoin','Oxcarbazepine'],             prefer:['Levetiracetam','Lamotrigine','Valproate'], note:'ë‡Œì¢…ì–‘: íš¨ì†Œ ìœ ë„ ì•½ë¬¼ í•­ì•”ì œ íš¨ëŠ¥ ê°ì†Œ. LevetiracetamÂ·LamotrigineÂ·Valproate ì„ í˜¸.' },
  polypharmacy: { avoid:['Carbamazepine','Phenobarbital','Phenytoin','Oxcarbazepine'],             prefer:['Levetiracetam'],               note:'ë‹¤ì¤‘ ì•½ë¬¼: íš¨ì†Œ ìœ ë„ ì•½ë¬¼ ìƒí˜¸ì‘ìš© ìœ„í—˜. Levetiracetam ì„ í˜¸.' },
  ocp:          { avoid:['Carbamazepine','Phenobarbital','Phenytoin','Oxcarbazepine','Topiramate'],prefer:['Levetiracetam'],               note:'ê²½êµ¬í”¼ì„ì•½: íš¨ì†Œ ìœ ë„ ì•½ë¬¼Â·Topiramate í”¼ì„ íš¨ëŠ¥ ê°ì†Œ. Levetiracetam ì„ í˜¸.' },
  anticoagulant:{ avoid:['Carbamazepine','Phenobarbital','Phenytoin'],                                                                     note:'í•­ì‘ê³ ì œ: íš¨ì†Œ ìœ ë„ ì•½ë¬¼ í•­ì‘ê³ ì œ ëŒ€ì‚¬ ì¦ê°€ë¡œ í˜ˆì „ ìœ„í—˜ ìƒìŠ¹.' },
  elderly:      { avoid:['Carbamazepine','Phenobarbital','Phenytoin'],                             prefer:['Lamotrigine','Levetiracetam'], note:'ê³ ë ¹ì: íš¨ì†Œ ìœ ë„Â·ì§„ì •ì œ ë¶€ì‘ìš© ìœ„í—˜. LamotrigineÂ·Levetiracetam ì„ í˜¸. ì €ìš©ëŸ‰ ì‹œì‘.' },
  child:        {                                                                                                                           note:'ì†Œì•„: ì—°ë ¹ë³„ ì ì‘ì¦ í™•ì¸ í•„ìˆ˜. Ethosuximide(ê²°ì‹ ), Levetiracetam, Carbamazepine ì‚¬ìš© ê°€ëŠ¥. Vigabatrinì€ ì˜ì•„ ì—°ì¶• íŠ¹í™”.' },
  cognitive:    { avoid:['Topiramate','Phenobarbital','Phenytoin'],                                prefer:['Levetiracetam','Lamotrigine'], note:'ì¸ì§€ ì €í•˜: TopiramateÂ·Phenobarbital ì¸ì§€ ì˜í–¥ í¼. LevetiracetamÂ·Lamotrigine ì„ í˜¸.' },
};

const SZ_NAMES = {
  focal:'êµ­ì†Œ ë°œì‘', focal_bilateral:'êµ­ì†Œâ†’ì–‘ì¸¡ ê°•ì§ê°„ëŒ€',
  generalized_tonic_clonic:'ì „ì‹  ê°•ì§ê°„ëŒ€', absence:'ê²°ì‹  ë°œì‘',
  myoclonic:'ê·¼ê°„ëŒ€ ë°œì‘', absence_myoclonic:'ê²°ì‹  + ê·¼ê°„ëŒ€',
  atonic_tonic:'ë¬´ê¸´ì¥/ê°•ì§ ë°œì‘', mixed_generalized:'í˜¼í•© ì „ì‹  ë°œì‘', spasms:'ì—°ì¶• (ì˜ì•„)',
};
const MOD_NAMES = {
  child:'ì†Œì•„', elderly:'ê³ ë ¹ì', female_cbp:'ê°€ì„ê¸° ì—¬ì„±', pregnant:'ì„ì‹ ',
  depression:'ìš°ìš¸ì¦/ë¶ˆì•ˆ', migraine:'í¸ë‘í†µ', obesity:'ë¹„ë§Œ', renal:'ì‹ ë¶€ì „',
  liver:'ê°„ì§ˆí™˜', cardiac:'ì‹¬ì¥ì§ˆí™˜', osteoporosis:'ê³¨ë‹¤ê³µì¦', tumor:'ë‡Œì¢…ì–‘',
  polypharmacy:'ë‹¤ì¤‘ ì•½ë¬¼', ocp:'ê²½êµ¬í”¼ì„ì•½', anticoagulant:'í•­ì‘ê³ ì œ', cognitive:'ì¸ì§€ ì €í•˜',
};

/* â”€â”€ State â”€â”€ */
let selSz   = null;
let selMods = new Set();
let curStep = 1;

/* â”€â”€ Navigation â”€â”€ */
function goToStep(n) {
  if (n === 1) showPage(1);
  else if (n === 2 && selSz) showPage(2);
}
function showPage(n) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + n).classList.add('active');
  curStep = n;
  updateSteps();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function updateSteps() {
  [1,2,3].forEach(i => {
    const el = document.getElementById('si-' + i);
    if (!el) return;
    el.classList.remove('active','done');
    if (i === curStep) el.classList.add('active');
    else if (i < curStep) el.classList.add('done');
  });
}
function nextStep() {
  if (!selSz) { flashWarn('warn-1'); return; }
  showPage(2);
}
function prevStep() {
  if (curStep === 2) showPage(1);
  else if (curStep === 3) showPage(2);
}
function flashWarn(id) {
  const el = document.getElementById(id);
  el.classList.remove('show');
  void el.offsetWidth; // reflow to restart animation
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 3000);
}
function resetAll() {
  selSz = null; selMods.clear();
  document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
  document.querySelectorAll('.mod-item').forEach(item => {
    item.classList.remove('checked');
    const chk = item.querySelector('.mod-chk');
    chk.textContent = '';
    chk.style.cssText = '';
  });
  showPage(1);
}

/* â”€â”€ Seizure selection â”€â”€ */
function selectSeizure(type) {
  selSz = type;
  document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('sz-' + type).classList.add('selected');
  document.getElementById('warn-1').classList.remove('show');
}

/* â”€â”€ Demographic single-select â”€â”€ */
const DEMOG_KEYS = ['child','elderly','female_cbp','pregnant'];

function selectDemog(key) {
  // Deselect all other demog options first
  DEMOG_KEYS.forEach(k => {
    if (k === key) return;
    selMods.delete(k);
    const item = document.getElementById('mod-' + k);
    const chk  = document.getElementById('chk-' + k);
    item.classList.remove('checked');
    chk.textContent = '';
    chk.style.cssText = '';
  });
  // Toggle the clicked one
  toggleMod(key);
}

/* â”€â”€ Modifier toggle â”€â”€ */
function toggleMod(key) {
  const item = document.getElementById('mod-' + key);
  const chk  = document.getElementById('chk-' + key);
  if (selMods.has(key)) {
    selMods.delete(key);
    item.classList.remove('checked');
    chk.textContent = '';
    chk.style.cssText = '';
  } else {
    selMods.add(key);
    item.classList.add('checked');
    chk.textContent = 'âœ“';
    chk.style.background  = 'var(--accent)';
    chk.style.borderColor = 'var(--accent)';
    chk.style.color       = 'white';
  }
}

/* â”€â”€ Results â”€â”€ */
function showResults() {
  const base = ASM[selSz];
  let g1 = [...base.g1], g2 = [...base.g2], g3 = [...base.g3];
  const avoidSet = new Set(), preferSet = new Set(), notes = [];

  selMods.forEach(mod => {
    const r = RULES[mod]; if (!r) return;
    (r.avoid  || []).forEach(d => avoidSet.add(d));
    (r.prefer || []).forEach(d => preferSet.add(d));
    if (r.note) notes.push(r.note);
  });

  // Demote avoided drugs one tier
  const newG1 = g1.filter(d => !avoidSet.has(d));
  const demG1 = g1.filter(d =>  avoidSet.has(d));
  const newG2 = [...g2.filter(d => !avoidSet.has(d)), ...demG1];
  const demG2 = g2.filter(d =>  avoidSet.has(d));
  const newG3 = [...g3.filter(d => !avoidSet.has(d)), ...demG2];

  // Promote preferred drugs from g2 â†’ g1
  const finalG1 = [...newG1];
  const finalG2 = [];
  newG2.forEach(d => {
    if (preferSet.has(d) && !finalG1.includes(d)) finalG1.push(d);
    else finalG2.push(d);
  });

  drawGroup('g1-tags', finalG1, g1, avoidSet, preferSet);
  drawGroup('g2-tags', finalG2, g2, avoidSet, preferSet);
  drawGroup('g3-tags', newG3,   g3, avoidSet, preferSet);

  // Summary
  const bar = document.getElementById('summary-bar');
  bar.innerHTML = '<strong style="font-size:12px;color:var(--text-muted)">ì„ íƒëœ ì¡°ê±´</strong>';
  [[SZ_NAMES[selSz]], ...[...selMods].map(m => MOD_NAMES[m] || m)].flat().forEach(lbl => {
    const t = document.createElement('span');
    t.className = 'summary-tag'; t.textContent = lbl;
    bar.appendChild(t);
  });

  // Notes
  const ns = document.getElementById('mod-notes');
  if (notes.length) {
    ns.style.display = 'block';
    document.getElementById('notes-list').innerHTML =
      notes.map(n => `<div class="mod-note-item"><span class="dot"></span><span>${n}</span></div>`).join('');
  } else {
    ns.style.display = 'none';
  }

  document.getElementById('result-desc').textContent =
    `${SZ_NAMES[selSz]} Â· ìˆ˜ì •ì¸ì ${selMods.size}ê°œ ì ìš©`;

  showPage(3);
}

function drawGroup(id, drugs, originals, avoidSet, preferSet) {
  const c = document.getElementById(id);
  c.innerHTML = '';
  if (!drugs.length) {
    c.innerHTML = '<span style="font-size:12px;color:var(--text-muted)">í•´ë‹¹ ì—†ìŒ</span>';
    return;
  }
  drugs.forEach(key => {
    const wrap = document.createElement('div');
    wrap.className = 'asm-tag';

    const en = document.createElement('span');
    en.textContent = key;
    wrap.appendChild(en);

    const ko = DRUG_KO[key];
    if (ko && ko !== key) {
      const ks = document.createElement('span');
      ks.className = 'drug-ko';
      ks.textContent = ko;
      wrap.appendChild(ks);
    }

    if (preferSet.has(key) && !originals.includes(key)) { wrap.classList.add('up');   wrap.title = 'ìˆ˜ì •ì¸ìë¡œ ìš°ì„ ë„ ìƒìŠ¹'; }
    if (avoidSet.has(key))                               { wrap.classList.add('down'); wrap.title = 'ìˆ˜ì •ì¸ìë¡œ ìš°ì„ ë„ í•˜í–¥'; }

    c.appendChild(wrap);
  });
}
</script>
</body>
</html>
